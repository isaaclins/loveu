<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>loveu.ch ‚Äì Crochet Grid Tools</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <div class="app">
        <!-- Landing / Mode Selection -->
        <section class="screen active" id="homeScreen">
            <div class="home-content">
                <div class="logo">
                    <span class="logo-text">loveu</span><span class="logo-dot">.ch</span>
                </div>
                <p class="home-subtitle">Turn any photo into a crochet pattern</p>
                
                <div class="home-buttons">
                    <button class="big-btn primary" id="startCreateBtn">
                        <span class="btn-icon">üé®</span>
                        <span class="btn-label">Create Pattern</span>
                        <span class="btn-hint">From a photo</span>
                    </button>
                    <button class="big-btn secondary" id="startGuideBtn">
                        <span class="btn-icon">üß∂</span>
                        <span class="btn-label">Start Stitching</span>
                        <span class="btn-hint">Follow a pattern</span>
                    </button>
                    <button class="big-btn tertiary" id="startPaintByNumberBtn">
                        <span class="btn-icon">üî¢</span>
                        <span class="btn-label">Paint by Numbers</span>
                        <span class="btn-hint">Create coloring page</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- CREATE FLOW: Step 1 - Upload -->
        <section class="screen" id="uploadScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="homeScreen">‚Üê</button>
                <div class="step-indicator">Step 1 of 3</div>
            </header>
            
            <div class="screen-body">
                <h1 class="screen-title">Pick a photo</h1>
                <p class="screen-desc">Choose any image you want to turn into a pattern</p>
                
                <label class="upload-zone" id="uploadZone">
                    <input type="file" id="imageInput" accept="image/*" hidden>
                    <div class="upload-placeholder" id="uploadPlaceholder">
                        <span class="upload-icon">üì∑</span>
                        <span class="upload-text">Tap to choose photo</span>
                    </div>
                    <canvas id="originalCanvas" class="upload-preview hidden"></canvas>
                </label>
            </div>
            
            <footer class="screen-footer">
                <button class="nav-btn primary" id="toSettingsBtn" disabled>Continue ‚Üí</button>
            </footer>
        </section>

        <!-- CREATE FLOW: Step 2 - Settings -->
        <section class="screen" id="settingsScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="uploadScreen">‚Üê</button>
                <div class="step-indicator">Step 2 of 3</div>
            </header>
            
            <div class="screen-body">
                <h1 class="screen-title">Adjust settings</h1>
                <p class="screen-desc">These defaults work great ‚Äî or tweak them!</p>
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <label class="setting-label">Grid Width</label>
                        <div class="stepper">
                            <button class="stepper-btn" data-target="colsInput" data-delta="-5">‚àí</button>
                            <input type="number" id="colsInput" value="30" min="5" max="100">
                            <button class="stepper-btn" data-target="colsInput" data-delta="5">+</button>
                        </div>
                    </div>
                    <div class="setting-card">
                        <label class="setting-label">Grid Height</label>
                        <div class="stepper">
                            <button class="stepper-btn" data-target="rowsInput" data-delta="-5">‚àí</button>
                            <input type="number" id="rowsInput" value="30" min="5" max="100">
                            <button class="stepper-btn" data-target="rowsInput" data-delta="5">+</button>
                        </div>
                    </div>
                    <div class="setting-card full">
                        <label class="setting-label">Number of Colors</label>
                        <div class="stepper">
                            <button class="stepper-btn" data-target="colorsInput" data-delta="-1">‚àí</button>
                            <input type="number" id="colorsInput" value="5" min="2" max="12">
                            <button class="stepper-btn" data-target="colorsInput" data-delta="1">+</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="screen-footer">
                <button class="nav-btn primary" id="processBtn">
                    <span class="btn-spinner hidden"></span>
                    <span>Create Pattern ‚ú®</span>
                </button>
            </footer>
        </section>

        <!-- CREATE FLOW: Step 3 - Result -->
        <section class="screen" id="resultScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="settingsScreen">‚Üê</button>
                <div class="step-indicator">Done! üéâ</div>
            </header>
            
            <div class="screen-body">
                <h1 class="screen-title">Your pattern is ready</h1>
                
                <div class="result-preview">
                    <canvas id="gridCanvas"></canvas>
                </div>
                
                <div class="palette-section">
                    <h3 class="palette-title">Your colors</h3>
                    <div id="paletteSwatches" class="palette"></div>
                </div>
            </div>
            
            <footer class="screen-footer stacked">
                <button class="nav-btn primary" id="sendToGuideBtn">Start Stitching üß∂</button>
                <div class="secondary-actions">
                    <button class="icon-btn" id="downloadPngBtn" title="Save as image">
                        <span>üì•</span> Save Image
                    </button>
                    <button class="icon-btn" id="downloadJsonBtn" title="Save pattern file">
                        <span>üíæ</span> Save Pattern
                    </button>
                </div>
            </footer>
        </section>

        <!-- GUIDE FLOW: Load Pattern -->
        <section class="screen" id="guideLoadScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="homeScreen">‚Üê</button>
                <div class="step-indicator">Load Pattern</div>
            </header>
            
            <div class="screen-body centered">
                <h1 class="screen-title">Load your pattern</h1>
                <p class="screen-desc">Import a saved pattern to start stitching</p>
                
                <div class="load-options">
                    <label class="load-option">
                        <input type="file" id="gridInput" accept="application/json" hidden>
                        <span class="load-icon">üìÅ</span>
                        <span class="load-text">Open saved pattern</span>
                    </label>
                    <button class="load-option" id="useLastBtn" disabled>
                        <span class="load-icon">‚è±Ô∏è</span>
                        <span class="load-text">Use last pattern</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- GUIDE FLOW: Stepper -->
        <section class="screen" id="guideScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="guideLoadScreen">‚Üê</button>
                <div class="progress-mini">
                    <div class="progress-mini-fill" id="progressFill"></div>
                </div>
                <span class="progress-text" id="progressText">0%</span>
            </header>
            
            <div class="screen-body guide-body">
                <div class="guide-instruction">
                    <div class="guide-meta" id="guideMeta">Row 1</div>
                    <div class="guide-current" id="guideCurrent">‚Äî</div>
                    <div class="guide-next" id="guideNext">Next: ‚Äî</div>
                </div>
                
                <div class="guide-canvas-wrap">
                    <canvas id="guideCanvas"></canvas>
                </div>
            </div>
            
            <footer class="screen-footer guide-footer">
                <button class="guide-btn icon-only" id="undoBtn" disabled title="Undo">
                    ‚Ü©Ô∏è
                </button>
                <button class="guide-btn big primary" id="nextBtn" disabled>
                    Next ‚Üí
                </button>
                <button class="guide-btn icon-only" id="resetGuideBtn" disabled title="Reset">
                    üîÑ
                </button>
            </footer>
        </section>

        <!-- PAINT BY NUMBERS FLOW: Upload -->
        <section class="screen" id="pbnUploadScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="homeScreen">‚Üê</button>
                <div class="step-indicator">Step 1 of 3</div>
            </header>
            
            <div class="screen-body">
                <h1 class="screen-title">Pick a photo</h1>
                <p class="screen-desc">Choose any image to convert to paint by numbers</p>
                
                <label class="upload-zone" id="pbnUploadZone">
                    <input type="file" id="pbnImageInput" accept="image/*" hidden>
                    <div class="upload-placeholder" id="pbnUploadPlaceholder">
                        <span class="upload-icon">üñºÔ∏è</span>
                        <span class="upload-text">Tap to choose photo</span>
                    </div>
                    <canvas id="pbnOriginalCanvas" class="upload-preview hidden"></canvas>
                </label>
            </div>
            
            <footer class="screen-footer">
                <button class="nav-btn primary" id="pbnToSettingsBtn" disabled>Continue ‚Üí</button>
            </footer>
        </section>

        <!-- PAINT BY NUMBERS FLOW: Settings -->
        <section class="screen" id="pbnSettingsScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="pbnUploadScreen">‚Üê</button>
                <div class="step-indicator">Step 2 of 3</div>
            </header>
            
            <div class="screen-body">
                <h1 class="screen-title">Adjust settings</h1>
                <p class="screen-desc">Configure your paint by numbers image</p>
                
                <div class="settings-grid">
                    <div class="setting-card full">
                        <label class="setting-label">Number of Colors</label>
                        <div class="stepper">
                            <button class="stepper-btn" data-target="pbnColorsInput" data-delta="-1">‚àí</button>
                            <input type="number" id="pbnColorsInput" value="9" min="2" max="15">
                            <button class="stepper-btn" data-target="pbnColorsInput" data-delta="1">+</button>
                        </div>
                    </div>
                    <div class="setting-card full">
                        <label class="setting-label">Detail Level</label>
                        <div class="stepper">
                            <button class="stepper-btn" data-target="pbnDetailInput" data-delta="-10">‚àí</button>
                            <input type="number" id="pbnDetailInput" value="50" min="20" max="100">
                            <button class="stepper-btn" data-target="pbnDetailInput" data-delta="10">+</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="screen-footer">
                <button class="nav-btn primary" id="pbnProcessBtn">
                    <span class="btn-spinner hidden"></span>
                    <span>Create Paint by Numbers ‚ú®</span>
                </button>
            </footer>
        </section>

        <!-- PAINT BY NUMBERS FLOW: Result -->
        <section class="screen" id="pbnResultScreen">
            <header class="screen-header">
                <button class="back-btn" data-goto="pbnSettingsScreen">‚Üê</button>
                <div class="step-indicator">Done! üéâ</div>
            </header>
            
            <div class="screen-body">
                <h1 class="screen-title">Your coloring page</h1>
                
                <div class="pbn-preview-container">
                    <div class="pbn-toggle-group">
                        <button class="pbn-toggle active" id="pbnShowOutline">Outline</button>
                        <button class="pbn-toggle" id="pbnShowColored">Colored</button>
                    </div>
                    <div class="result-preview">
                        <canvas id="pbnResultCanvas"></canvas>
                    </div>
                </div>
                
                <div class="pbn-legend" id="pbnLegend"></div>
            </div>
            
            <footer class="screen-footer stacked">
                <button class="nav-btn primary" id="pbnDownloadBtn">üì• Download PNG</button>
            </footer>
        </section>

        <!-- Hidden back button for compatibility -->
        <button id="backBtn" hidden disabled></button>
    </div>

    <!-- Tutorial overlay (simplified) -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-modal">
            <div class="tutorial-head">
                <div class="tutorial-title">Quick Start</div>
                <button class="tutorial-close" id="tutorialClose" aria-label="Close">√ó</button>
            </div>
            <div class="tutorial-step" id="tutorialStep">Loading‚Ä¶</div>
            <div class="tutorial-progress"><div id="tutorialProgressBar"></div></div>
            <div class="tutorial-actions">
                <button id="tutorialBack">Back</button>
                <button id="tutorialAction">Try Demo</button>
                <button id="tutorialNext">Next</button>
            </div>
        </div>
    </div>

    <button class="fab-help" id="tutorialBtn" aria-label="Help">?</button>

    <script src="script.js"></script>
</body>
</html>
